<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Migraciones y Cancelaciones</title>
<style>
  body { font-family: Arial,sans-serif; background:#F4F9FB; margin:0; padding:20px; display:flex; justify-content:center; align-items:flex-start; min-height:100vh;}
  .container { background:#fff; padding:20px 30px; border-radius:14px; box-shadow:0 6px 14px rgba(0,0,0,0.1); width:90%; max-width:1000px; box-sizing:border-box;}
  h1 { text-align:center; color:#01768b; margin-bottom:20px; font-size:28px;}
  details { margin-bottom:25px; border:1px solid #ccc; border-radius:8px; padding:10px 15px; background:#fafafa;}
  details summary { font-weight:bold; cursor:pointer; color:#0c477e; font-size:16px;}
  details p { margin:10px 0; font-size:15px;}
  h2 { color:#0c477e; font-size:20px; margin-top:20px;}

  .input-row { display:flex; gap:15px; flex-wrap:wrap; margin-bottom:20px;}
  .input-group { display:flex; flex-direction:column; flex:1; min-width:150px; box-sizing:border-box;}
  .input-group label { font-size:13px; margin-bottom:6px; font-weight:500; color:#333;}
  input, select { width:100%; padding:10px; border:1.5px solid #ccc; border-radius:8px; font-size:14px; outline:none; transition:0.3s; background:#fff;}
  input:focus, select:focus { border-color:#01768b; background:#f8ffff;}

  .input-with-mark { display:flex; align-items:center; gap:4px;}
  .input-with-mark span { font-weight:bold; color:#000;}

  .dni-container { display:flex; gap:10px;}
  .dni-container input { flex:1; padding:10px; border:1.5px solid #ccc; border-radius:8px; font-size:14px;}
  .dni-container button { padding:10px 15px; background:#01768b; border:none; border-radius:8px; color:white; cursor:pointer; transition:0.3s;}
  .dni-container button:hover { background:#0c477e;}

  .buttons { margin-top:25px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;}
  .buttons button { padding:12px 24px; border:none; border-radius:8px; cursor:pointer; font-weight:500; transition:0.3s; font-size:15px; background:#01768b; color:white;}
  .buttons button:hover { background:#0c477e;}

  #mensaje { margin-top:25px; text-align:center; font-size:15px; font-weight:500;}
  #speech { margin-top:25px; padding:15px; border:1px dashed #01768b; border-radius:8px; background:#fdfdfd; display:none;}
  #speech h3 { margin-top:0; margin-bottom:10px; color:#0c477e; font-size:20px; font-weight:bold;}
  #speech .green { color:#01768b; font-weight:bold; }
  .blue { color:#0c477e; }

  .plan-details { margin-top:15px; padding:15px; border:1px solid #ccc; border-radius:8px; background:#fafafa; display:none;}
  .plan-details.show { display:block;}
  .plan-details .row { display:grid; grid-template-columns:1fr 1fr; gap:20px;}
  .plan-details .col { padding:10px; background:#fff; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.05);}
  .plan-details h3 { margin-top:0; color:#01768b; font-size:16px; border-bottom:1px solid #eee; padding-bottom:6px;}

  .modal { display:none; position:fixed; z-index:1000; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;}
  .modal.show { display:flex;}
  .modal-content { background:#fff; padding:25px; border-radius:12px; text-align:center; max-width:400px; box-shadow:0 6px 14px rgba(0,0,0,0.2);}
  .modal-content h2 { color:#0c477e; margin-bottom:15px; }
  .modal-buttons { display:flex; justify-content:center; gap:15px; margin-top:20px; flex-wrap:wrap;}
  .modal-buttons button { padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-weight:500; color:#fff;}
  .btn-yes { background:#01768b;} .btn-yes:hover { background:#0c477e; }
  .btn-no { background:#c62828;} .btn-no:hover { background:#a61c1c; }

  @media (max-width: 768px){
    .input-row { flex-direction:column; }
    .plan-details .row { grid-template-columns:1fr; }
    .buttons button, .modal-buttons button { width:100%; }
  }
</style>
</head>
<body>
<div class="container">
<h1>Migraciones y Cancelaciones</h1>

<details>
  <summary>Presentaci√≥n:</summary>
  <p>1. Hola, te habla <span class="blue">(Nombre del agente)</span> de Bitel. ¬øMe brindar√≠a su nombre?</p>
  <p>2. <span class="blue">(Nombre del cliente)</span>, ¬øQu√© operaci√≥n va a realizar?</p>
  <p>3. El n√∫mero que llama es el que quiere migrar, termina en <span class="blue">XXXX</span></p>
  <p>4. ¬øPodr√≠as indicarme el motivo de la migraci√≥n y a qu√© plan deseas cambiarte?</p>
</details>

<h2>Llenado de datos</h2>
<form id="miFormulario" onsubmit="return false;">
  <!-- Usuario de agente -->
  <div class="input-row">
    <div class="input-group">
      <label for="usuarioAgente">Usuario de agente</label>
      <input type="text" id="usuarioAgente" placeholder="cpc_xxxx_vtp" style="text-transform: lowercase;">
    </div>
  </div>

  <!-- ID de llamada -->
  <div class="input-row">
    <div class="input-group">
      <label for="idEntrante">ID de llamada entrante</label>
      <div class="input-with-mark">
        <span>$$_</span>
        <input type="text" id="idEntrante" placeholder="ID directo" oninput="toggleID('entrante')">
        <span>_&&</span>
      </div>
    </div>
    <div class="input-group">
      <label for="idSaliente">ID de llamada saliente</label>
      <div class="input-with-mark">
        <span>$$_</span>
        <input type="text" id="idSaliente" placeholder="ID directo" oninput="toggleID('saliente')">
        <span>_&&</span>
      </div>
    </div>
  </div>

  <!-- N√∫mero de documento -->
  <div class="input-row">
    <div class="input-group">
      <label for="dni">N√∫mero de documento</label>
      <div class="dni-container">
        <input type="text" id="dni" maxlength="8" placeholder="8 d√≠gitos">
        <button type="button" onclick="buscarDNI()">üîç</button>
      </div>
    </div>
  </div>

  <!-- Tel√©fonos -->
  <div class="input-row">
    <div class="input-group">
      <label for="telefonoEntrante">Tel√©fono entrante</label>
      <input type="text" id="telefonoEntrante" maxlength="9" placeholder="9 d√≠gitos">
    </div>
    <div class="input-group">
      <label for="telefonoSolicitud">Tel√©fono de solicitud</label>
      <input type="text" id="telefonoSolicitud" maxlength="9" placeholder="9 d√≠gitos">
    </div>
  </div>

  <!-- Motivo y Plan -->
  <div class="input-row">
    <div class="input-group">
      <label for="motivo">Motivo de migraci√≥n</label>
      <select id="motivo">
        <option value="">Seleccione...</option>
        <option value="Opci√≥n 1">Opci√≥n 1</option>
        <option value="Opci√≥n 2">Opci√≥n 2</option>
        <option value="Opci√≥n 3">Opci√≥n 3</option>
      </select>
    </div>
    <div class="input-group">
      <label for="plan">Plan deseado a migrar</label>
      <select id="plan" onchange="mostrarPlan()">
        <option value="">Seleccione...</option>
        <option value="Bifri5">Bifri5</option>
        <option value="Ilimitado 29.90">Ilimitado 29.90</option>
      </select>
    </div>
  </div>

  <!-- Detalle del plan -->
  <div class="plan-details" id="planDetails">
    <div class="row">
      <div class="col">
        <h3>Detalle</h3>
        <div id="detalle"></div>
      </div>
      <div class="col">
        <h3>Consideraciones</h3>
        <div id="consideraciones"></div>
      </div>
    </div>
  </div>

  <!-- Autofill DNI -->
  <div id="autofill" style="display:none;">
    <div class="input-row">
      <div class="input-group">
        <label for="nombre">Nombre completo</label>
        <input type="text" id="nombre" readonly>
      </div>
      <div class="input-group">
        <label for="fechaNacimiento">Fecha de nacimiento</label>
        <input type="text" id="fechaNacimiento" readonly>
      </div>
      <div class="input-group">
        <label for="ubicacion">Departamento - Provincia - Distrito</label>
        <input type="text" id="ubicacion" readonly>
      </div>
    </div>
  </div>

  <div class="buttons">
    <button type="button" onclick="abrirConfirmacion()">Guardar</button>
    <button type="button" onclick="limpiar()">Limpiar</button>
  </div>
</form>

<div id="mensaje"></div>
<div id="speech"></div>

</div>

<!-- Modal -->
<div id="confirmModal" class="modal">
  <div class="modal-content">
    <h2>‚ö†Ô∏è Confirmaci√≥n</h2>
    <p>¬øCliente est√° de acuerdo en generar la migraci√≥n?</p>
    <div class="modal-buttons">
      <button class="btn-yes" onclick="guardar()">S√≠</button>
      <button class="btn-no" onclick="cerrarModal()">No</button>
    </div>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/TU_SCRIPT_ID/exec";
const MY_SECRET_TOKEN = "BitelMigracion2025SuperClave";

// Ocultar ID contrario
function toggleID(tipo){
  const idEntrante = document.getElementById("idEntrante");
  const idSaliente = document.getElementById("idSaliente");
  if(tipo==="entrante") idSaliente.parentElement.style.display = idEntrante.value.trim() ? "none" : "flex";
  if(tipo==="saliente") idEntrante.parentElement.style.display = idSaliente.value.trim() ? "none" : "flex";
}

function buscarDNI(){
  const dni = document.getElementById("dni").value.trim();
  if(dni.length!==8){ alert("Ingrese un DNI v√°lido de 8 d√≠gitos"); return; }
  document.getElementById("nombre").value="Juan Perez";
  document.getElementById("fechaNacimiento").value="15/08/1990";
  document.getElementById("ubicacion").value="Lima - Lima - San Isidro";
  document.getElementById("autofill").style.display="block";
}

function mostrarPlan(){
  const plan=document.getElementById("plan").value;
  const detalle=document.getElementById("detalle");
  const consideraciones=document.getElementById("consideraciones");
  const planDetails=document.getElementById("planDetails");
  if(plan==="Bifri5"){
    detalle.innerHTML="<ul><li>5GB de datos</li><li>Redes sociales libres</li><li>30 minutos a todo operador</li></ul>";
    consideraciones.innerHTML="<ul><li>Vigencia 30 d√≠as</li><li>No acumulable</li><li>Recarga m√≠nima S/5</li></ul>";
    planDetails.classList.add("show");
  } else if(plan==="Ilimitado 29.90"){
    detalle.innerHTML="<ul><li>Llamadas ilimitadas a todo operador</li><li>10GB de alta velocidad</li><li>WhatsApp ilimitado</li></ul>";
    consideraciones.innerHTML="<ul><li>Velocidad reducida despu√©s de 10GB</li><li>No incluye roaming</li><li>Costo fijo mensual S/29.90</li></ul>";
    planDetails.classList.add("show");
  } else { planDetails.classList.remove("show"); }
}

function abrirConfirmacion(){document.getElementById("confirmModal").classList.add("show");}
function cerrarModal(){document.getElementById("confirmModal").classList.remove("show");}

async function guardar(){
  cerrarModal();
  const usuarioAgente=document.getElementById("usuarioAgente").value.trim();
  const idEntrante=document.getElementById("idEntrante").value.trim()||"";
  const idSaliente=document.getElementById("idSaliente").value.trim()||"";
  const telefonoEntrante=document.getElementById("telefonoEntrante").value.trim();
  const telefonoSolicitud=document.getElementById("telefonoSolicitud").value.trim();
  const dni=document.getElementById("dni").value.trim();
  const motivo=document.getElementById("motivo").value;
  const plan=document.getElementById("plan").value;
  if(!usuarioAgente||!telefonoEntrante||!telefonoSolicitud||!dni||!motivo||!plan){
    document.getElementById("mensaje").textContent="‚ö†Ô∏è Complete todos los campos obligatorios.";return;
  }
  const data=new URLSearchParams({
    token:MY_SECRET_TOKEN,
    usuarioAgente,
    idEntrante:idEntrante ? `$$_${idEntrante}_&&` : '',
    idSaliente:idSaliente ? `$$_${idSaliente}_&&` : '',
    telefonoEntrante,
    telefonoSolicitud,
    dni,
    nombre:document.getElementById("nombre").value,
    fechaNacimiento:document.getElementById("fechaNacimiento").value,
    ubicacion:document.getElementById("ubicacion").value,
    motivo,plan
  });
  try{
    const resp=await fetch(SCRIPT_URL,{method:"POST",body:data});
    const raw=await resp.text();
    let result={};
    try{result=JSON.parse(raw);}catch(e){console.error("No JSON:",raw);}
    if(result.result==="success"){
      const codigo=result.codigo||"C√≥digo no recibido";
      document.getElementById("mensaje").innerHTML=`‚úÖ Datos guardados correctamente.<br><span class="codigo">üîê C√≥digo de solicitud: ${codigo}</span>`;
      let planTexto=plan==="Bifri5"?"Prepago: Bifri5":"Control: Ilimitado 29.90";
      document.getElementById("speech").innerHTML=`<h3>Speech final</h3>üó£Ô∏è <span class="blue">Agente:</span> ‚ÄúSe ha gestionado la migraci√≥n de su l√≠nea <span class='green'>${telefonoSolicitud}</span> al plan ${planTexto}. El cambio se realizar√° en un m√°ximo de 24 horas. Cuando pierda se√±al, reinicie su equipo y haga una llamada para activar el servicio. Recibir√° el c√≥digo de solicitud por SMS o email.<br><br> El c√≥digo de solicitud es <span class='green'>${codigo}</span> y lo recibir√° por SMS y/o email.<br><br> Eso ser√≠a todo de mi parte. Gracias por comunicarse. En breve recibir√° una encuesta por SMS para calificar mi atenci√≥n. Que tenga un excelente d√≠a.‚Äù`;
      document.getElementById("speech").style.display="block";
      limpiar(false);
    } else {
      document.getElementById("mensaje").textContent="‚ùå Error al guardar: "+(result.message||"Respuesta inesperada");
    }
  } catch(err){
    document.getElementById("mensaje").textContent="‚ùå Error de conexi√≥n: "+err.message;
  }
}

function limpiar(borrarMensaje=true){
  document.getElementById("miFormulario").reset();
  document.getElementById("autofill").style.display="none";
  document.getElementById("planDetails").classList.remove("show");
  document.getElementById("idEntrante").parentElement.style.display="flex";
  document.getElementById("idSaliente").parentElement.style.display="flex";
  if(borrarMensaje){
    document.getElementById("mensaje").textContent="";
    document.getElementById("speech").style.display="none";
  }
}
</script>
</body>
</html>
