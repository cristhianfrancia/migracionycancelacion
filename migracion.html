<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Migraciones y Cancelaciones - Bitel Per√∫</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bitel-green: #01768b;
      --bitel-dark: #0c477e;
      --bitel-yellow: #fbf32f;
      --bg: #F4F9FB;
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 20px;
      -webkit-font-smoothing:antialiased;
    }

    header {
      text-align: center;
      padding: 18px 10px 6px;
    }

    header h1 {
      font-size: 28px;
      margin: 6px 0;
      color: var(--bitel-green); /* verdecito */
      font-weight: 700;
    }

    header p {
      margin: 6px 0 0;
      color: var(--bitel-dark); /* azulito */
      font-size: 15px;
      line-height: 1.3;
    }

    .container {
      max-width: 900px; /* m√°s ancho que antes */
      margin: 22px auto;
      background: #fff;
      padding: 26px 30px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(2,24,30,0.06);
      border-top: 6px solid var(--bitel-yellow); /* l√≠nea amarilla */
    }

    .row {
      display: flex;
      gap: 16px;
    }

    .two-columns {
      display: flex;
      gap: 16px;
      justify-content: center; /* centra horizontalmente las dos columnas */
    }

    .col {
      flex: 0 0 48%; /* dos columnas iguales y amplias */
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: var(--bitel-green);
      font-weight: 600;
      font-size: 14px;
    }

    input[type="text"], input[type="date"], select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d0d6da;
      font-size: 15px;
      box-sizing: border-box;
    }

    input[readonly] {
      background: #f6f8fa;
      color: #333;
    }

    .input-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .input-group input {
      flex: 1;
    }

    .btn-lupa {
      background: var(--bitel-dark);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }

    .detalle-plan {
      margin-top: 12px;
    }

    .detalle-plan .cols {
      display: flex;
      gap: 12px;
    }

    .detalle-plan .cols > div {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      background: #fbfdff;
      border: 1px solid #e6eef4;
      font-size: 14px;
    }

    .btn-container {
      display: flex;
      gap: 12px;
      margin-top: 18px;
      justify-content: center; /* centra los botones */
    }

    .btn-save {
      background: var(--bitel-green);
      color: white;
      padding: 11px 22px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      min-width: 140px;
    }

    .btn-clear {
      background: var(--bitel-yellow);
      color: var(--bitel-dark);
      padding: 11px 22px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      min-width: 140px;
    }

    /* Responsive */
    @media (max-width: 720px) {
      .two-columns { flex-direction: column; }
      .col { flex: 1; }
      .detalle-plan .cols { flex-direction: column; }
      .btn-container { flex-direction: column; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Migraciones y Cancelaciones</h1>
    <p><strong>Te saluda (Nombre y apellido del agente) del √°rea de Migraciones y Cancelaciones.</strong><br>Por favor, me confirma su:</p>
  </header>

  <div class="container">

    <!-- Tel√©fonos centrados en dos columnas -->
    <div class="two-columns">
      <div class="col">
        <label for="telefonoEntrante">Tel√©fono entrante</label>
        <input type="text" id="telefonoEntrante" maxlength="9" placeholder="9 d√≠gitos">
      </div>
      <div class="col">
        <label for="telefonoSolicitud">Tel√©fono de solicitud</label>
        <input type="text" id="telefonoSolicitud" maxlength="9" placeholder="9 d√≠gitos">
      </div>
    </div>

    <!-- DNI con lupa -->
    <div style="margin-top:10px;">
      <label for="dni">N√∫mero de documento</label>
      <div class="input-group">
        <input type="text" id="dni" maxlength="8" placeholder="Ingrese DNI (8 d√≠gitos)">
        <button type="button" class="btn-lupa" onclick="buscarDni()">üîç</button>
      </div>
    </div>

    <!-- Datos autollenados desde RENIEC (simulaci√≥n) -->
    <div id="datosReniec" style="display:none; margin-top:12px;">
      <label for="nombreCompleto">Nombre completo</label>
      <input type="text" id="nombreCompleto" readonly>

      <label for="fechaNacimiento">Fecha de nacimiento</label>
      <input type="text" id="fechaNacimiento" readonly placeholder="DD/MM/AAAA">

      <label for="ubicacion">Departamento - Provincia - Distrito de nacimiento</label>
      <input type="text" id="ubicacion" readonly>
    </div>

    <!-- Motivo y Plan -->
    <div style="margin-top:12px;">
      <label for="motivo">Motivo de migraci√≥n</label>
      <select id="motivo">
        <option value="">Seleccione...</option>
        <option value="Opci√≥n 1">Opci√≥n 1</option>
        <option value="Opci√≥n 2">Opci√≥n 2</option>
        <option value="Opci√≥n 3">Opci√≥n 3</option>
      </select>
    </div>

    <div style="margin-top:6px;">
      <label for="plan">Plan deseado a migrar</label>
      <select id="plan" onchange="mostrarDetalle()">
        <option value="">Seleccione...</option>
        <option value="Bifri5">Bifri5</option>
        <option value="Ilimitado 29.90">Ilimitado 29.90</option>
      </select>
    </div>

    <div id="detallePlan" class="detalle-plan"></div>

    <!-- Botones centrados -->
    <div class="btn-container">
      <button class="btn-save" onclick="guardarDatos()">Guardar</button>
      <button class="btn-clear" onclick="limpiarFormulario()">Limpiar</button>
    </div>

  </div>

  <script>
    // Cambia aqu√≠ si tu URL o token son otros
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzF-x1tGW3OogOyy8cJZr836QuXAvIULsRHJFNZObVn58f3QNV2ZE5Fb9s7Us_8dmHIlw/exec";
    const MY_SECRET_TOKEN = "BitelMigracion2025SuperClave"; // aseg√∫rate que coincida con el SECRET en Apps Script

    function capitalizeName(name) {
      if (!name) return '';
      return name.split(' ').map(w => {
        w = w.trim();
        if (!w) return '';
        return w.charAt(0).toUpperCase() + w.slice(1).toLowerCase();
      }).filter(Boolean).join(' ');
    }

    function formatDateToDDMMYYYY(isoDate) {
      // espera 'YYYY-MM-DD' o Date objeto
      if (!isoDate) return '';
      let d;
      if (typeof isoDate === 'string' && isoDate.includes('-')) {
        d = new Date(isoDate);
      } else if (isoDate instanceof Date) {
        d = isoDate;
      } else {
        return isoDate;
      }
      if (isNaN(d)) return '';
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yyyy = d.getFullYear();
      return `${dd}/${mm}/${yyyy}`;
    }

    function buscarDni() {
      const dni = document.getElementById('dni').value.trim();
      if (dni.length !== 8) {
        alert('Ingrese un DNI v√°lido de 8 d√≠gitos.');
        return;
      }

      // Simulaci√≥n: aqu√≠ puedes reemplazar por fetch a tu API cuando la tengas
      const datos = {
        nombre: 'juan p√©rez lopez', // ejemplo en min√∫sculas para demostrar formateo
        fecha: '1995-09-20', // ISO para transformar a DD/MM/AAAA
        ubicacion: 'Lima - Lima - Miraflores'
      };

      // Formatea y muestra
      document.getElementById('nombreCompleto').value = capitalizeName(datos.nombre);
      document.getElementById('fechaNacimiento').value = formatDateToDDMMYYYY(datos.fecha);
      document.getElementById('ubicacion').value = datos.ubicacion;

      // Mostrar bloque de datos
      document.getElementById('datosReniec').style.display = 'block';
    }

    function mostrarDetalle() {
      const plan = document.getElementById('plan').value;
      const detalleDiv = document.getElementById('detallePlan');
      detalleDiv.innerHTML = '';

      if (plan === 'Bifri5') {
        detalleDiv.innerHTML = `\n          <div class="cols">\n            <div><strong>Detalle de Bifri5</strong><br>- 5GB de datos<br>- 100 minutos</div>\n            <div><strong>Consideraciones de Bifri5</strong><br>- V√°lido solo en Per√∫</div>\n          </div>`;
      } else if (plan === 'Ilimitado 29.90') {
        detalleDiv.innerHTML = `\n          <div class="cols">\n            <div><strong>Detalle de Ilimitado 29.90</strong><br>- Datos ilimitados<br>- Minutos ilimitados</div>\n            <div><strong>Consideraciones de Ilimitado 29.90</strong><br>- Sujeto a pol√≠tica de uso justo</div>\n          </div>`;
      }
    }

    async function guardarDatos() {
      const data = {
        token: MY_SECRET_TOKEN,
        telefonoEntrante: document.getElementById('telefonoEntrante').value.trim(),
        telefonoSolicitud: document.getElementById('telefonoSolicitud').value.trim(),
        dni: document.getElementById('dni').value.trim(),
        nombre: document.getElementById('nombreCompleto').value.trim(),
        fechaNacimiento: document.getElementById('fechaNacimiento').value.trim(),
        ubicacion: document.getElementById('ubicacion').value.trim(),
        motivo: document.getElementById('motivo').value,
        plan: document.getElementById('plan').value
      };

      if (!data.dni || data.dni.length !== 8) {
        alert('Por favor ingresa un DNI v√°lido de 8 d√≠gitos antes de guardar.');
        return;
      }

      try {
        const resp = await fetch(SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          mode: 'cors',
          body: JSON.stringify(data)
        });
        const result = await resp.json();
        // soporta diferentes formas de respuesta: {result:'success'} o {status:'success'}
        if (result && (result.result === 'success' || result.status === 'success')) {
          alert('‚úÖ Datos guardados en Google Sheets.');
          limpiarFormulario();
        } else {
          console.error('Guardar - respuesta inesperada:', result);
          alert('Error al guardar: ' + (result && (result.message||result.msg) ? (result.message||result.msg) : 'Revisa consola.'));
        }
      } catch (err) {
        console.error('Error de red al guardar:', err);
        alert('Error de conexi√≥n al intentar guardar. Revisa la consola.');
      }
    }

    function limpiarFormulario() {
      document.getElementById('telefonoEntrante').value = '';
      document.getElementById('telefonoSolicitud').value = '';
      document.getElementById('dni').value = '';
      document.getElementById('nombreCompleto').value = '';
      document.getElementById('fechaNacimiento').value = '';
      document.getElementById('ubicacion').value = '';
      document.getElementById('motivo').value = '';
      document.getElementById('plan').value = '';
      document.getElementById('detallePlan').innerHTML = '';
      document.getElementById('datosReniec').style.display = 'none';
    }
  </script>
</body>
</html>
